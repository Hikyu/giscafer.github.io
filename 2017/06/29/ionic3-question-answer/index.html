<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ionic3开发遇到的一些问题及解决方法 | Giscafer&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="两年前，第一家公司用过ionic1开发过APP，当时对ionic1了解的不是很熟，加上是ng1的开发。今年公司重写APP更换技术框架为ionic3，配合ng4的开发，个人感觉开发上效率比较高。
不能使用组件名称作为条件判断依据为了实现token失效或超时登录，接口拦截请求跳转登录页面，起初我用了组件名称LoginPage作为判断，因为首页请求三个接口，进入首页的时候，三次请求都会判断为token失">
<meta property="og:type" content="article">
<meta property="og:title" content="ionic3开发遇到的一些问题及解决方法">
<meta property="og:url" content="http://blog.giscafer.com/2017/06/29/ionic3-question-answer/index.html">
<meta property="og:site_name" content="Giscafer's blog">
<meta property="og:description" content="两年前，第一家公司用过ionic1开发过APP，当时对ionic1了解的不是很熟，加上是ng1的开发。今年公司重写APP更换技术框架为ionic3，配合ng4的开发，个人感觉开发上效率比较高。
不能使用组件名称作为条件判断依据为了实现token失效或超时登录，接口拦截请求跳转登录页面，起初我用了组件名称LoginPage作为判断，因为首页请求三个接口，进入首页的时候，三次请求都会判断为token失">
<meta property="og:image" content="http://blog.giscafer.com/static/img/ionic3-question-answer1.png">
<meta property="og:image" content="http://blog.giscafer.com/static/img/ionic3-question-answer2.gif">
<meta property="og:updated_time" content="2017-06-29T14:30:00.572Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ionic3开发遇到的一些问题及解决方法">
<meta name="twitter:description" content="两年前，第一家公司用过ionic1开发过APP，当时对ionic1了解的不是很熟，加上是ng1的开发。今年公司重写APP更换技术框架为ionic3，配合ng4的开发，个人感觉开发上效率比较高。
不能使用组件名称作为条件判断依据为了实现token失效或超时登录，接口拦截请求跳转登录页面，起初我用了组件名称LoginPage作为判断，因为首页请求三个接口，进入首页的时候，三次请求都会判断为token失">
<meta name="twitter:image" content="http://blog.giscafer.com/static/img/ionic3-question-answer1.png">
  
    <link rel="alternate" href="/atom.xml" title="Giscafer&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.giscafer.com"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="http://project.giscafer.com">项目</a>
        
          <a class="main-nav-link" href="/aboutme">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Giscafer&#39;s blog</a>
      </h1>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ionic3-question-answer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/29/ionic3-question-answer/" class="article-date">
  <time datetime="2017-06-29T14:06:54.000Z" itemprop="datePublished">2017-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/技术/">技术</a>►<a class="article-category-link" href="/categories/技术/Ionic/">Ionic</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ionic3开发遇到的一些问题及解决方法
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>两年前，第一家公司用过ionic1开发过APP，当时对ionic1了解的不是很熟，加上是ng1的开发。今年公司重写APP更换技术框架为ionic3，配合ng4的开发，个人感觉开发上效率比较高。</p>
<h3 id="不能使用组件名称作为条件判断依据"><a href="#不能使用组件名称作为条件判断依据" class="headerlink" title="不能使用组件名称作为条件判断依据"></a>不能使用组件名称作为条件判断依据</h3><p>为了实现token失效或超时登录，接口拦截请求跳转登录页面，起初我用了组件名称LoginPage作为判断，因为首页请求三个接口，进入首页的时候，三次请求都会判断为token失效，都会跳转登录页面，如果不做当前是否为登录页面判断，都跳转登录页面的话，会出现三次登录页面的重复跳转。</p>
<p>最开始代码为：<code>代码片段1</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//登录失效，自动跳转登录页面</span></div><div class="line">  <span class="keyword">if</span> (json[<span class="string">"code"</span>] === <span class="number">-9999</span>) &#123;</div><div class="line">       <span class="keyword">let</span> curActiveView = <span class="keyword">this</span>.nav.getActive();</div><div class="line">        <span class="comment">//根据登录页面组件名称为LoginPage判断</span></div><div class="line">       <span class="keyword">if</span> (curActiveView &amp;&amp; curActiveView.component.name!==<span class="string">'LoginPage'</span>) &#123;</div><div class="line">          <span class="keyword">this</span>.nav.push(LoginPage);</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>然后改为：<code>代码片段2</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//登录失效，自动跳转登录页面</span></div><div class="line">  <span class="keyword">if</span> (json[<span class="string">"code"</span>] === <span class="number">-9999</span>) &#123;</div><div class="line">       <span class="keyword">let</span> curActiveView = <span class="keyword">this</span>.nav.getActive();</div><div class="line">            <span class="comment">//登录页面组件中的变量判断</span></div><div class="line">       <span class="keyword">if</span> (curActiveView &amp;&amp; !curActiveView.instance.loginPageModele) &#123;</div><div class="line">          <span class="keyword">this</span>.nav.push(LoginPage);</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p><code>代码片段1</code>中在debug模式，cordova run android或者cordova build android下都不会有问题。问题在产品模式打包下，加上<code>--prod</code>后缀打包就会有问题。因为<code>代码片段1</code>在–prod模式下代码会被压缩混淆了，组件名称都会改为<code>n</code>了，所有的组件名称都为<code>n</code>，也不清楚为什么都一样。</p>
<p><img src="/static/img/ionic3-question-answer1.png" alt=""></p>
<p>所以<code>代码片段2</code>为解决方案，组件名称压缩混淆，但是组件实例变量是不会混淆压缩的。</p>
<h3 id="图片的相对路径问题"><a href="#图片的相对路径问题" class="headerlink" title="图片的相对路径问题"></a>图片的相对路径问题</h3><p>ionic浏览器开发调式和build打包时路径是不一致的。如果在html页面里边直接写图片路径，就写到assets，比如<code>&lt;img src=&quot;assets/ui/certification.png&quot; width=&quot;40%&quot; height=&quot;40%&quot;&gt;</code>；但如果是在scss文件样式里边写，就用<code>../assets/</code>，比如<code>url(&quot;../assets/ui/tabs/icon_home_on.png&quot;);</code>。这样就能保证手机端和浏览器端都兼容了。</p>
<h3 id="ionic3新增了懒加载机制，-IonicPage"><a href="#ionic3新增了懒加载机制，-IonicPage" class="headerlink" title="ionic3新增了懒加载机制，@IonicPage()"></a>ionic3新增了懒加载机制，@IonicPage()</h3><p>如果使用命令创建页面<code>ionic g page xxxPage</code>的话，你会发现命令生成一个组件带有xxx.module.ts的文件，这个是配合组件xxx.component.ts里边的<code>@IonicPage()</code>进行懒加载的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; NgModule &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</div><div class="line"><span class="keyword">import</span> &#123; IonicPageModule &#125; <span class="keyword">from</span> <span class="string">'ionic-angular'</span>;</div><div class="line"><span class="keyword">import</span> &#123; CertificationModalPage &#125; <span class="keyword">from</span> <span class="string">'./certification-modal'</span>;</div><div class="line"></div><div class="line">@NgModule(&#123;</div><div class="line">  <span class="attr">declarations</span>: [</div><div class="line">    CertificationModalPage,</div><div class="line">  ],</div><div class="line">  <span class="attr">imports</span>: [</div><div class="line">  <span class="comment">//就是这里了。</span></div><div class="line">    IonicPageModule.forChild(CertificationModalPage),</div><div class="line">  ],</div><div class="line">  <span class="attr">exports</span>: [</div><div class="line">    CertificationModalPage</div><div class="line">  ]</div><div class="line">&#125;)</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">CertificationModalPageModule</span> </span>&#123;&#125;</div></pre></td></tr></table></figure>
<p>懒加载使用也必将方便，组件页面不需要注册，不用在app.module.ts里边declarations了。使用的时候用组件名称字符串替代。比如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">openCertificationModal() &#123;</div><div class="line">    <span class="comment">//'CertificationModalPage' 组件名称字符串就是懒加载，使用的时候不需要import导入改组件，直接字符串，ionic会帮我们注册组件和找到该组件。</span></div><div class="line">        <span class="keyword">let</span> myModal = <span class="keyword">this</span>.modalCtrl.create(<span class="string">'CertificationModalPage'</span>, &#123;&#125;, &#123;</div><div class="line">            <span class="attr">cssClass</span>: <span class="string">'custom-modal'</span></div><div class="line">        &#125;);</div><div class="line">        myModal.present();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>ionic3这个懒加载的特性，在开发的时候，创建页面就直接用起来，省去了很多注册组件的麻烦工作了。</p>
<p>当然，如果是纯组件，就建议使用非懒加载的方式，正常的根据ng2模块注册的方式声明注册。</p>
<h3 id="ModalController自定义弹窗"><a href="#ModalController自定义弹窗" class="headerlink" title="ModalController自定义弹窗"></a>ModalController自定义弹窗</h3><p><code>ModalController</code>是ionic3的API，使用它可以创建一个modal作为弹窗。弹窗是全屏的，不管是android是ios，wp中都是全屏。开发页面的时候，可能需要不是全屏的弹窗，但有不是alert的效果。</p>
<p>这时候有两个选择：</p>
<ul>
<li><p>自己用html写封装弹窗组件（开发时间可能多一些，封装成组件后还要考虑兼容性和动画效果等）</p>
</li>
<li><p>基于ModalController修改（样式覆盖，改为非全屏的小弹窗）</p>
</li>
</ul>
<p>二选一，都可以的。只要时间允许。由于App开发的时候时间很紧，就使用了第二种方式。下边简单介绍一下。</p>
<p>覆盖<code>ion-modal</code>样式要注意不能影响全局，如果样式全局覆盖了，全局的modal弹窗都会受到影响，这就不是想要的接口。ModalController API 提供了cssClass 选项，可以覆盖默认的样式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">openCertificationModal() &#123;</div><div class="line">    <span class="comment">//cssClass: 'custom-modal'为自定义覆盖样式</span></div><div class="line">        <span class="keyword">let</span> myModal = <span class="keyword">this</span>.modalCtrl.create(<span class="string">'CertificationModalPage'</span>, &#123;&#125;, &#123;</div><div class="line">            <span class="attr">cssClass</span>: <span class="string">'custom-modal'</span></div><div class="line">        &#125;);</div><div class="line">        myModal.present();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>样式</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">.custom-modal &#123;</div><div class="line">    // transparent black background overlay</div><div class="line">    background-color: rgba(0, 0, 0, .5) !important;</div><div class="line">    transition: opacity .25s ease-in-out;</div><div class="line">    padding: 20vh 10vw;</div><div class="line">    .scroll-content&#123;</div><div class="line">        overflow-x: hidden;</div><div class="line">        overflow-y: hidden;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终效果</p>
<p><img src="/static/img/ionic3-question-answer2.gif" alt="自定义样式modal效果"></p>
<p><em>未完待续……</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.giscafer.com/2017/06/29/ionic3-question-answer/" data-id="cj4iiape10037b8z5x1d3nhon" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ionic/">ionic</a></li></ul>

    </footer>
  </div>
  
    
 <script src="/jquery/jquery.min.js"></script>
  <div id="random_posts">
    <h2>推荐文章</h2>
    <div class="random_posts_ul">
      <script>
          var random_count =4
          var site = {BASE_URI:'/'};
          function load_random_posts(obj) {
              var arr=site.posts;
              if (!obj) return;
              // var count = $(obj).attr('data-count') || 6;
              for (var i, tmp, n = arr.length; n; i = Math.floor(Math.random() * n), tmp = arr[--n], arr[n] = arr[i], arr[i] = tmp);
              arr = arr.slice(0, random_count);
              var html = '<ul>';
            
              for(var j=0;j<arr.length;j++){
                var item=arr[j];
                html += '<li><strong>' + 
                item.date + ':&nbsp;&nbsp;<a href="' + (site.BASE_URI+item.uri) + '">' + 
                (item.title || item.uri) + '</a></strong>'+
                '<div class="post-excerpt">'+item.excerpt+'</div></li>';
              }
              $(obj).html(html + '</ul>');
          }
          $('.random_posts_ul').each(function () {
              var c = this;
              if (!site.posts || !site.posts.length){
                  $.getJSON(site.BASE_URI + 'js/posts.js',function(json){site.posts = json;load_random_posts(c)});
              } 
               else{
                load_random_posts(c);
              }
          });
      </script>
    </div>
  </div>

    
<nav id="article-nav">
  
  
    <a href="/2017/06/27/ionic3-tab-custom-icon/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">ionic3之自定义tabs菜单图标</div>
    </a>
  
</nav>

  
</article>
 
     
  <div class="comments" id="comments">
    
     
       
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
       
      
      
  </div>
 
  

</section>
           
    <aside id="sidebar">
  
    

  
    
    <div class="widget-wrap">
    
      <div class="widget" id="toc-widget-fixed">
      
        <strong class="toc-title">文章目录</strong>
        <div class="toc-widget-list">
              <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#不能使用组件名称作为条件判断依据"><span class="toc-number">1.</span> <span class="toc-text">不能使用组件名称作为条件判断依据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图片的相对路径问题"><span class="toc-number">2.</span> <span class="toc-text">图片的相对路径问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ionic3新增了懒加载机制，-IonicPage"><span class="toc-number">3.</span> <span class="toc-text">ionic3新增了懒加载机制，@IonicPage()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModalController自定义弹窗"><span class="toc-number">4.</span> <span class="toc-text">ModalController自定义弹窗</span></a></li></ol>
          </div>
      </div>
    </div>

  
    

  
    
  
    
  
    

  
    <!--微信公众号二维码-->


  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2017 giscafer&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;giscafer@outlook.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="http://project.giscafer.com" class="mobile-nav-link">项目</a>
  
    <a href="/aboutme" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>